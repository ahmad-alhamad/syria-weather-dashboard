<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Syria Weather Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link href="https://api.mapbox.com/mapbox-gl-js/v3.6.0/mapbox-gl.css" rel="stylesheet" />
<script src="https://api.mapbox.com/mapbox-gl-js/v3.6.0/mapbox-gl.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
html, body { height:100%; margin:0; font-family:Arial, sans-serif; }
#map { position:absolute; inset:0; transition: left 0.3s; }

#city-name { position:absolute; top:10px; left:50%; transform:translateX(-50%); padding:8px 16px; background:rgba(0,0,0,0.7); color:#fff; font-size:18px; font-weight:bold; border-radius:8px; z-index:5; }

#sidebar { position:absolute; top:60px; left:10px; width:280px; background:linear-gradient(135deg,#1f1f1f,#3b3b3b); color:#fff; padding:15px; border-radius:12px; box-shadow:0 0 12px rgba(0,0,0,0.5); z-index:5; transition: width 0.3s, padding 0.3s; }
#sidebar.minimized { width:50px; padding:15px 5px; }
#sidebar h2 { margin-top:0; text-align:center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
#sidebar button#sidebar-toggle { margin-bottom:10px; padding:6px 12px; border:none; border-radius:6px; background:#ff9800; color:#fff; font-weight:bold; cursor:pointer; width:100%; }

#temp-scale { margin-bottom:12px; padding:10px; background:rgba(0,0,0,0.35); border-radius:8px; font-size:14px; transition: opacity 0.3s; }
#sidebar.minimized #temp-scale { opacity:0; pointer-events:none; }
.scale-title { text-align:center; font-weight:bold; margin-bottom:6px; }
.scale-item { display:flex; align-items:center; gap:8px; margin:4px 0; }
.scale-color { width:16px; height:16px; border-radius:4px; }
.scale-color.cold { background:#1e88e5; }
.scale-color.mild { background:#ffeb3b; }
.scale-color.hot  { background:#e53935; }

#weather-details { margin-bottom:10px; transition: opacity 0.3s; }
#sidebar.minimized #weather-details { opacity:0; pointer-events:none; }

#temp-squares { display:flex; justify-content:space-between; margin-top:10px; transition: opacity 0.3s; }
#sidebar.minimized #temp-squares { opacity:0; pointer-events:none; }

#forecast-chart { transition: opacity 0.3s; }
#sidebar.minimized #forecast-chart { opacity:0; pointer-events:none; }

#theme-toggle { position:absolute; top:10px; right:10px; padding:6px 12px; border:none; border-radius:6px; background:#ff9800; font-weight:bold; cursor:pointer; z-index:5; }

#weather-layer { position:absolute; inset:0; pointer-events:none; z-index:3; }
.weather-animation { position:absolute; transform:translate(-50%, -50%); }
.raindrop { width:3px; height:12px; background:#00bfff; border-radius:50%; animation:fall linear infinite; }
@keyframes fall { 0% { transform:translateY(0); opacity:1; } 100% { transform:translateY(50px); opacity:0; } }

#floating-chat { position:fixed; bottom:20px; right:20px; width:280px; background:#2c2c2c; border-radius:12px; box-shadow:0 0 15px rgba(0,0,0,0.5); display:flex; flex-direction:column; z-index:10; }
#floating-chat-header { padding:10px; background:#ff9800; border-top-left-radius:12px; border-top-right-radius:12px; cursor:pointer; font-weight:bold; text-align:center; color:#fff; }
#floating-chat-body { padding:10px; height:200px; overflow-y:auto; color:#fff; font-size:14px; }
#floating-chat-input { display:flex; border-top:1px solid #444; }
#floating-chat-input input { flex:1; padding:6px; border:none; border-radius:0 0 0 12px; outline:none; }
#floating-chat-input button { padding:6px 10px; border:none; background:#ff9800; color:#fff; font-weight:bold; cursor:pointer; border-radius:0 0 12px 0; }
</style>
</head>

<body>
<div id="map"></div>
<div id="weather-layer"></div>
<div id="city-name">Click a city to see weather</div>

<div id="sidebar">
  <button id="sidebar-toggle">Minimize Sidebar</button>
  <h2>Weather Info</h2>
  <div id="temp-scale">
    <div class="scale-title">Temperature Scale</div>
    <div class="scale-item"><span class="scale-color cold"></span> Cold &lt; 10-15°C</div>
    <div class="scale-item"><span class="scale-color mild"></span> Mild 15–25°C</div>
    <div class="scale-item"><span class="scale-color hot"></span> Hot &gt; 25°C</div>
  </div>
  <div id="weather-details">Click on a city</div>
  <div id="temp-squares">
    <div class="temp-square" id="square1"></div>
    <div class="temp-square" id="square2"></div>
    <div class="temp-square" id="square3"></div>
  </div>
  <canvas id="forecast-chart" height="150"></canvas>
</div>

<button id="theme-toggle">Toggle Dark/Light</button>

<div id="floating-chat">
  <div id="floating-chat-header">AI Helper</div>
  <div id="floating-chat-body"></div>
  <div id="floating-chat-input">
    <input type="text" id="chat-input" placeholder="Type your message..." />
    <button id="chat-send">Send</button>
  </div>
</div>

<script>
// Map & Weather code (same as your previous version)
mapboxgl.accessToken = 'pk.eyJ1IjoiYWhtYWQtdGVjaCIsImEiOiJjbWY5czYwcjUxaXhrMmlxczZvamlmNm5tIn0.nJnJvwt0e4etH4CvHl0iMw';
const WEATHER_API_KEY = 'b8978e6145de48af927132212262401';
const cities = [
  { name:'Damascus', coords:[36.2765,33.5147] },
  { name:'Aleppo', coords:[37.1343,36.2021] },
  { name:'Homs', coords:[36.7137,34.7324] },
  { name:'Hama', coords:[36.7578,35.1318] },
  { name:'Daraa', coords:[36.1021,32.6255] },
  { name:'Raqqa', coords:[39.0196,35.9506] },
  { name:'Deir Ezzor', coords:[40.1408,35.3359] },
  { name:'Hasakah', coords:[40.7477,36.5166] }
];
const features = cities.map((c,i)=>({type:'Feature',properties:{name:c.name},geometry:{type:'Point', coordinates:c.coords},id:i}));

let currentStyle = 'mapbox://styles/mapbox/dark-v11';
const map = new mapboxgl.Map({container:'map',style:currentStyle,center:[38.9968,34.8021],zoom:6.5,minZoom:6.5,maxZoom:6.5,projection:'globe'});
function addCityCircles(){ if(map.getSource('city-centers')) return; map.addSource('city-centers',{type:'geojson',data:{type:'FeatureCollection',features},generateId:true}); map.addLayer({id:'city-circles',type:'circle',source:'city-centers',paint:{'circle-radius':60,'circle-color':'#4da6ff','circle-opacity':0.3,'circle-stroke-width':2,'circle-stroke-color':'#003366'}});}
map.on('load', addCityCircles);
map.on('click','city-circles', async (e)=>{ const city=e.features[0].properties.name; document.getElementById('city-name').innerText=city; const coords=e.features[0].geometry.coordinates; await fetchWeather(city, coords); animateWeather(city, coords); });
map.on('click',(e)=>{ if(!map.queryRenderedFeatures(e.point,{layers:['city-circles']}).length){ document.getElementById('city-name').innerText='Click a city to see weather'; document.getElementById('weather-details').innerText='Click on a city'; ['square1','square2','square3'].forEach(id=>document.getElementById(id).style.background='#555'); if(window.forecastChart) window.forecastChart.destroy(); clearWeatherAnimations(); }});

async function fetchWeather(city, coords){
  const [lon,lat]=coords;
  const res=await fetch(`https://api.weatherapi.com/v1/forecast.json?key=${WEATHER_API_KEY}&q=${lat},${lon}&days=5`);
  const data=await res.json();
  const temp=data.current.temp_c;
  let color=temp>25?'#e53935':(temp>=15?'#ffeb3b':'#1e88e5');
  ['square1','square2','square3'].forEach(id=>document.getElementById(id).style.background=color);
  document.getElementById('weather-details').innerHTML=`<strong>${city}</strong><br>Temp: ${temp}°C<br>Humidity: ${data.current.humidity}%<br>Wind: ${data.current.wind_kph} kph<br>Condition: ${data.current.condition.text}`;
  if(window.forecastChart) window.forecastChart.destroy();
  const labels=data.forecast.forecastday.map(d=>d.date);
  const temps=data.forecast.forecastday.map(d=>d.day.avgtemp_c);
  window.forecastChart=new Chart(document.getElementById('forecast-chart'),{type:'line',data:{labels,datasets:[{data:temps,borderColor:'#ff9800',fill:false,tension:0.3}]},options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:false}}}});
}

// Sidebar minimize toggle
const sidebar=document.getElementById('sidebar');
const sidebarToggle=document.getElementById('sidebar-toggle');
sidebarToggle.addEventListener('click',()=>{
  sidebar.classList.toggle('minimized');
  sidebarToggle.textContent = sidebar.classList.contains('minimized') ? 'Expand Sidebar' : 'Minimize Sidebar';
});
</script>

</body>
</html>
